<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                DEFAULT: "#ff800",
                light: "#ffb84d",
                dark: "#ff6600"
              }
            }
          }
        }
      };
    </script>
    <style>
      .spinner {
        border: 2px solid transparent;
        border-top-color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        animation: spin 0.75s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
    <script src="assets/js/cookiesManagement.js"></script>
    <script src="assets/js/checkNotAuth.js"></script>

</head>
<body>
    <body class="min-h-full bg-gradient-to-b from-white via-[#ffe0b2] to-[#ffb84d] flex items-center justify-center p-6">
      <div class="w-full max-w-sm sm:max-w-md bg-white/20 backdrop-blur-xl rounded-2xl shadow-lg ring-1 ring-gray-200 px-8 py-10 space-y-6">
        <!-- Logo + Title -->
        <div class="flex flex-col items-center space-y-2">
          <img src="dims1.jpg" alt="Digimark Logo" class="h-16 w-16 select-none" />
          <h1 class="text-center text-lg font-semibold tracking-tight text-gray-800">
            Digimark Internship Intern Profile Form
          </h1>
        </div>
        <!-- Form -->
        <form id="loginForm" class="space-y-4 mt-5" action="#" method="POST" onsubmit="event.preventDefault(); makePostRequest();">
          <div>
            <label for="email" class="block text-sm font-medium text-gray-800">Email</label>
            <input required type="email" id="email" name="email" autocomplete="username" placeholder="Enter your email" class="mt-1 block w-full rounded-xl border-gray-300 focus:ring-brand focus:border-brand px-4 py-2.5 text-sm bg-white/80 text-gray-900 placeholder-gray-500" />
          </div>
          <div>
            <label for="password" class="block text-sm font-medium text-gray-800">Password</label>
            <div class="relative mt-1">
              <input required type="password" id="password" name="password" autocomplete="current-password" placeholder="Enter your password" class="block w-full rounded-xl border-gray-300 focus:ring-brand focus:border-brand px-4 py-2.5 text-sm pr-10 bg-white/80 text-gray-900 placeholder-gray-500" />
              <button type="button" id="togglePassword" aria-label="Show password" class="absolute inset-y-0 right-0 flex items-center pr-3">
                <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5 text-gray-500 dark:text-gray-400">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7 -1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
              </button>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <label class="inline-flex items-center space-x-2">
              <input type="checkbox" name="remember" class="rounded-md text-brand focus:ring-brand">
              <span class="text-sm text-gray-700">Remember me</span>
            </label>
            <a href="reset-password.html" class="text-sm font-medium text-brand hover:underline">Forgot Password?</a>
          </div>
          <button type="submit" id="loginBtn" class="w-full inline-flex justify-center items-center rounded-xl bg-gradient-to-br from-[#7a002b] to-[#b22234] hover:from-[#8a1538] hover:to-[#c72c41] focus:ring-4 focus:ring-[#7a002b]/40 text-white font-semibold py-2.5 transition-all">
            <span id="btnText">Login</span>
          </button>
        </form>
        <div class="flex items-center space-x-2">
          <span class="flex-grow h-px bg-gray-300"></span>
          <span class="text-xs uppercase text-gray-500">or</span>
          <span class="flex-grow h-px bg-gray-300"></span>
        </div>
        <p class="text-center text-sm text-gray-700">
          Donâ€™t have an account?
          <a href="register-intern.html" id="linkToRegister" class="font-medium text-brand hover:underline">Register here</a>
        </p>
      </div>

    <script src="assets/js/utils.js"></script>
    <script src="assets/js/cookiesManagement.js"></script>
    <script src="assets/js/checkNotAuth.js"></script>
    <script>
      // Password toggle logic
      const pwd     = document.getElementById("password");
      const toggle  = document.getElementById("togglePassword");
      const eyeIcon = document.getElementById("eyeIcon");
      const btn     = document.getElementById("loginBtn");
      const btnText = document.getElementById("btnText");
      if (toggle) {
        toggle.addEventListener("click", (e) => {
          e.preventDefault();
          const isHidden = pwd.type === "password";
          pwd.type = isHidden ? "text" : "password";
          eyeIcon.classList.toggle("opacity-40", !isHidden);
          toggle.setAttribute("aria-label", isHidden ? "Hide password" : "Show password");
          toggle.blur();
        });
      }
      // Register link with query params
      if(window.location.search.substring(1) != '')
        document.getElementById('linkToRegister').href = "register-intern.html?" + window.location.search.substring(1);
      // Login logic
      async function makePostRequest() {
        addLoader();
        let pwd = document.getElementById('password');
        let email = document.getElementById('email');
        try {
          btn.disabled = true;
          btnText.innerHTML = '<span class="spinner"></span>';
          const requestData = {
            email: email.value,
            password: pwd.value
          };
          const response = await fetch('https://auth.digimarkconsulting.cm/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData),
          });
          const result = await response.json();
          if (!response.ok) {
            if(!result.isVerified){
              window.location.assign(`verify-email.html`);
            }else {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
          }
          setCookie('token', result.token);
          setCookie('user_id', result.user.id);
          if(window.location.search.substring(1) != '') window.location.assign(window.location.search.substring(1));
          else window.location.assign('profile form.html');
        } catch (error) {
          console.error('Failed to fetch data:', error);
          btnText.textContent = 'Login';
          btn.disabled = false;
          showMessage('error', 'Oops', 'Incorrect username or password');
        }
      }
    </script>
</body>
</html>
